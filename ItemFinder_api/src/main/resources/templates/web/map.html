<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Map</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <style>
        #map {
            height: 500px;
            width: 85%;
            margin: 20px auto;
        }

        #options {
            text-align: center;
            padding: 10px;
            width: 85%;
            margin: 0 auto;
        }

        h1 {
            text-align: center;
            padding: 10px;
            width: 85%;
            margin: 0 auto;
        }

        #latitude, #longitude {
            width: 150px;
            margin-right: 10px;
        }

        #submitBtn {
            padding: 5px 10px;
        }
    </style>
</head>
<body>
<h1>Interactive Map</h1>
<div id="options">
    <input type="text" id="latitude" placeholder="Latitude" />
    <input type="text" id="longitude" placeholder="Longitude" />
    <button id="submitBtn">Show on Map</button>
</div>
<div id="map"></div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script th:inline="javascript">
    /*<![CDATA[*/
    const defaultLat = /*[[${latitude}]]*/ 52.968206004920546;
    const defaultLng = /*[[${longitude}]]*/ 18.047085141804097;
    /*]]>*/
</script>

<script>
    // Initialize the map with Thymeleaf-passed coordinates as defaults
    const map = L.map('map').setView([defaultLat, defaultLng], 8);

    // Add OpenStreetMap tiles
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        maxZoom: 19,
        attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
    }).addTo(map);

    // Add a draggable marker to the map at the default location
    const marker = L.marker([defaultLat, defaultLng], { draggable: true }).addTo(map);

    // Function to update latitude and longitude input fields with the marker's position
    function updateInputFields(lat, lng) {
        document.getElementById('latitude').value = lat.toFixed(6);
        document.getElementById('longitude').value = lng.toFixed(6);
    }

    // Update the input fields with initial marker position
    updateInputFields(defaultLat, defaultLng);

    // Update input fields whenever the marker is dragged
    marker.on('move', function(e) {
        const lat = e.target.getLatLng().lat;
        const lng = e.target.getLatLng().lng;
        updateInputFields(lat, lng);
    });

    // Function to update the map view and marker position
    function updateMap(lat, lng) {
        marker.setLatLng([lat, lng]); // Update marker position
        map.setView([lat, lng], map.getZoom()); // Center map on the new location
        updateInputFields(lat, lng); // Update input fields with new coordinates
    }

    // Handle map click to set new marker position
    map.on('click', function(e) {
        const lat = e.latlng.lat;
        const lng = e.latlng.lng;
        updateMap(lat, lng);
    });

    // Handle button click to set marker position based on inputs
    document.getElementById('submitBtn').addEventListener('click', function() {
        const lat = parseFloat(document.getElementById('latitude').value);
        const lng = parseFloat(document.getElementById('longitude').value);
        if (!isNaN(lat) && !isNaN(lng)) {
            updateMap(lat, lng);
        } else {
            alert("Please enter valid coordinates.");
        }
    });
</script>
</body>
</html>
